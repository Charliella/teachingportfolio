<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‹åœ‹å‹‡è€…ï¼šæ•¸å­¸ä¹‹ç›¾ Final Ultra Pro</title>
    <style>
        :root {
            --neon-green: #00ff41; --neon-orange: #f39c12; --neon-red: #ff003c;
            --neon-blue: #00d2ff; --bg-dark: #0a0a0b;
        }

        * { box-sizing: border-box; }
        html, body { 
            height: 100vh; width: 100vw; margin: 0; padding: 0; 
            overflow: hidden; background-color: var(--bg-dark);
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; color: #fff;
        }

        /* ä¸»å®¹å™¨ä½ˆå±€ï¼šå·¦å´éŠæˆ²(1fr) + å³å´æ¦œå–®(200px) */
        .game-wrapper {
            display: grid;
            grid-template-columns: 1fr 200px; 
            grid-template-rows: 10vh 1fr 35vh;
            gap: 1.5vh;
            height: 100vh;
            padding: 2vh;
        }

        /* æ¨™é¡Œèˆ‡å›é¥‹å€ */
        .level-header {
            grid-column: 1 / 2;
            background: rgba(243, 156, 18, 0.15);
            border-left: 12px solid var(--neon-orange);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 2vw;
        }
        .level-header h2 { margin: 0; font-size: 4vh; color: var(--neon-orange); }
        #feedback { font-size: 4vh; font-weight: 900; }

        /* å·¦å´ä¸»éŠæˆ²å€ */
        .main-content {
            grid-column: 1 / 2;
            display: flex; flex-direction: column; gap: 1vh;
            min-height: 0;
        }

        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1vw; }
        .stat-card { background: #1a1a1f; border: 1px solid #444; padding: 1vh; text-align: center; border-radius: 10px; }
        .stat-label { font-size: 1.8vh; color: #888; display: block; margin-bottom: 0.5vh; }
        .stat-value { font-size: 3.5vh; font-weight: bold; color: var(--neon-blue); }

        /* æ ¸å¿ƒèª¿æ•´ï¼šé¡Œç›®é¡¯ç¤ºå€ä½”æ“šæœ€å¤§ç•«é¢ */
        .question-display {
            flex-grow: 1; background: #000; border: 5px solid #333;
            display: flex; justify-content: center; align-items: center;
            font-size: 16vh; font-weight: 900; color: var(--neon-green);
            text-shadow: 0 0 40px rgba(0, 255, 65, 0.7);
            text-align: center; border-radius: 20px;
        }

        /* è§£ç­”è¼¸å…¥å€ */
        .answer-row { display: flex; justify-content: center; gap: 2vw; align-items: center; height: 16vh; }
        .input-box {
            background: #000; border: 6px solid #555; color: var(--neon-green);
            width: 25vw; height: 13vh; font-size: 10vh; text-align: center; border-radius: 20px;
        }
        .input-box.active { border-color: var(--neon-green); box-shadow: 0 0 30px rgba(0, 255, 65, 0.6); }

        /* å³å´æ’è¡Œæ¦œï¼šç¸®å°ç¯„åœä½†å­—é«”æ¸…æ¥š */
        .side-panel {
            grid-column: 2 / 3;
            grid-row: 1 / 4;
            background: #111; border: 2px solid var(--neon-blue);
            padding: 1.5vh 1vh; display: flex; flex-direction: column; border-radius: 15px;
        }
        .side-panel h3 { font-size: 2.2vh; color: var(--neon-blue); text-align: center; margin: 0 0 1.5vh 0; border-bottom: 1px solid var(--neon-blue); padding-bottom: 1vh; }
        .rank-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto; }
        .rank-item { padding: 0.8vh; font-size: 2.3vh; color: #555; border-bottom: 1px solid #222; text-align: left; }
        .rank-item.active { color: #fff; background: var(--neon-blue); font-weight: bold; border-radius: 8px; }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls-row {
            grid-column: 1 / 2;
            display: grid; grid-template-columns: 1.2fr 1fr; gap: 2vw;
        }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.2vh; }
        .key { background: #222; border: 1px solid #666; color: #fff; font-size: 4.5vh; cursor: pointer; border-radius: 15px; font-weight: bold; }
        .key:active { transform: scale(0.92); background: #444; }
        .key.action { background: var(--neon-orange); color: #000; font-size: 4vh; }
        .key.delete { background: var(--neon-red); }

        .btn-side { display: flex; flex-direction: column; gap: 1.5vh; }
        .special-btn {
            flex: 1; border: none; font-weight: 900; font-size: 3.5vh; color: #fff; cursor: pointer; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
        }
        .cheat-btn { background: #700; border: 3px solid var(--neon-red); }
        .rest-btn { background: #005577; border: 3px solid var(--neon-blue); }

        /* æ•…äº‹å½ˆçª—ï¼šé‡å°å¤§è¢å¹•å­—é«”å„ªåŒ– */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); justify-content: center; align-items: center; z-index: 11000;
        }
        .modal-content {
            background: #111; border: 6px solid var(--neon-blue); padding: 5vh;
            width: 90vw; height: 90vh; display: flex; flex-direction: column; border-radius: 30px;
        }
        #restStory { 
            font-size: 4vh; color: #f0f0f0; line-height: 1.8; text-align: left; 
            overflow-y: auto; flex-grow: 1; margin: 3vh 0; padding: 4vh; 
            background: #050505; border-radius: 20px; border: 2px solid #333;
        }
        #restStory b { color: var(--neon-orange); font-size: 4.5vh; }
        #playerName { font-size: 6vh; width: 100%; padding: 2vh; background: #000; color: var(--neon-blue); border: 4px solid var(--neon-blue); margin-top: 2vh; text-align: center; border-radius: 15px; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex; justify-content: center; align-items: center;
            padding: 5vw; text-align: center;
        }
    </style>
</head>
<body>

<div id="prologueOverlay" class="overlay">
    <div style="max-width: 1000px;">
        <h1 style="font-size: 9vh; color: var(--neon-orange); margin-bottom: 4vh;">âœ¨ ç‹åœ‹ç®—è¡“å±æ©Ÿ âœ¨</h1>
        <p style="font-size: 4.5vh; line-height: 1.6; color: #ccc;">ã€Œå¡çˆ¾å…‹åˆ©äºç‹åœ‹ã€çš„æ•¸å­—æ ¸å¿ƒè¢«æ‰“ç¢äº†ï¼<br>ç¾åœ¨è²·æ±è¥¿æœƒæ‰¾éŒ¯éŒ¢ï¼Œæ™‚é˜æœƒäº‚è·³ï¼Œå¤§å®¶éƒ½ä¸æœƒç®—æ•¸å•¦ï¼<br><br><b>ç®—è¡“å‹‡è€…å•Šï¼Œè«‹ç”¨ä½ çš„æ™ºæ…§ä¿®æ­£é€™ä¸€åˆ‡å§ï¼</b></p>
        <button class="key action" style="padding: 4vh 10vw; font-size: 6vh; margin-top: 6vh; height: auto;" onclick="startGame()">é–‹å§‹å†’éšªï¼</button>
    </div>
</div>

<div class="game-wrapper">
    <div class="level-header">
        <h2 id="levelTitle">LOADING...</h2>
        <div id="feedback" style="color: #666;">READY</div>
    </div>

    <div class="main-content">
        <div class="stats-row">
            <div class="stat-card"><span class="stat-label">ç›®å‰èº«ä»½</span><span class="stat-value" id="lvlStatus">æ‘èŠå¹³æ°‘</span></div>
            <div class="stat-card"><span class="stat-label">é€£çºŒæ­£ç¢º</span><span class="stat-value" id="streak">0</span></div>
            <div class="stat-card"><span class="stat-label">å¹³å‡ç§’æ•¸</span><span class="stat-value" id="avgTime">0</span>s</div>
            <div class="stat-card"><span class="stat-label">æ™‰ç´šæ¢ä»¶</span><span id="goalCond" style="font-size:1.8vh; color:#999;">-</span></div>
        </div>
        <div class="question-display" id="questionDisplay">---</div>
        <div class="answer-row">
            <input type="number" class="input-box active" id="ansMain" readonly placeholder="?">
            <div id="remainderZone" style="display:none">
                <input type="number" class="input-box" id="ansRem" readonly placeholder="é¤˜">
            </div>
        </div>
    </div>

    <div class="side-panel">
        <h3>å‹‡è€…æ’è¡Œæ¦œ</h3>
        <ul class="rank-list" id="rankListDisplay"></ul>
    </div>

    <div class="controls-row">
        <div class="keypad">
            <button class="key" onclick="pressKey(1)">1</button><button class="key" onclick="pressKey(2)">2</button><button class="key" onclick="pressKey(3)">3</button>
            <button class="key" onclick="pressKey(4)">4</button><button class="key" onclick="pressKey(5)">5</button><button class="key" onclick="pressKey(6)">6</button>
            <button class="key" onclick="pressKey(7)">7</button><button class="key" onclick="pressKey(8)">8</button><button class="key" onclick="pressKey(9)">9</button>
            <button class="key delete" onclick="pressKey('C')">æ¸…é™¤</button><button class="key" onclick="pressKey(0)">0</button>
            <button class="key action" onclick="check()">é€å‡ºç­”æ¡ˆ</button>
        </div>
        <div class="btn-side">
            <button class="special-btn cheat-btn" onclick="execCheat()">ç¦å¿Œå’’èªï¼šç¬é–“æ´å¯Ÿ</button>
            <button class="special-btn rest-btn" onclick="openRest()">ä»Šå¤©æƒ³ä¼‘æ¯äº†</button>
            <button class="key" style="background:none; border: 2px solid #444; font-size: 3vh;" onclick="location.reload()">é‡æ–°å•Ÿå‹•</button>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--neon-blue); font-size: 7vh; margin:0; text-align:center;">ğŸ“– å‹‡è€…å†’éšªå­˜æª”æ—¥è¨˜</h2>
        <div id="inputArea">
            <p style="font-size: 4vh; margin: 2vh 0; text-align:center;">è«‹è¼¸å…¥å‹‡è€…çš„åå­—ï¼š</p>
            <input type="text" id="playerName" placeholder="ä¾‹å¦‚ï¼šæ•¸å­¸å°å¤©æ‰">
        </div>
        <div id="restStory" style="display:none;"></div>
        <button class="key action" style="width:100%; height: 14vh; font-size: 6vh;" id="modalBtn" onclick="confirmRest()">ç¢ºèªå­˜æª”</button>
    </div>
</div>

<script>
    const levels = [
        { name: "é‹¼éµå‰å“¨ (åŠ æ³•)", type: "add", fast: [4, 3], slow: [8, 7] },
        { name: "å»¢åœŸç”Ÿå­˜ (æ¸›æ³•)", type: "sub", fast: [4, 3], slow: [8, 7] },
        { name: "å½ˆè—¥è£œçµ¦ (ä¹˜æ³•)", type: "multi99", fast: [3, 3], slow: [5, 7] },
        { name: "åŸå¸‚çªæ“Š (2x1)", type: "multi2x1", fast: [6, 3], slow: [14, 7] },
        { name: "ç«åŠ›è¦†è“‹ (2x2)", type: "multi2x2", fast: [10, 3], slow: [20, 7] },
        { name: "ç‹™æ“Šåº§æ¨™ (æ•´é™¤)", type: "divExact", fast: [10, 3], slow: [16, 7] },
        { name: "ç¢ç”²æŒ‡ä»¤ (é¤˜æ•¸I)", type: "divRem1", fast: [12, 3], slow: [26, 7] },
        { name: "æ ¸å¿ƒè§£æ (é¤˜æ•¸II)", type: "divRem2", fast: [16, 3], slow: [40, 6] },
        { name: "ä¹é‡å¤©é–€ (å…«é …é•·å¼)", type: "mix_9", fast: [35, 3], slow: [70, 6] },
        { name: "è«¸ç¥é»ƒæ˜ (åé …ç¥å¼)", type: "mix_10", fast: [45, 3], slow: [90, 6] }
    ];

    const heroes = ["æ‘èŠå¹³æ°‘", "æ–°å…µæˆ°å£«", "åµæŸ¥å°éšŠ", "é‡è£è¡›å…µ", "ç™¾äººéšŠé•·", "ç‹å®®ä¾è¡›", "æ¦®è€€é¨å£«", "å·¨é¾å°‡è»", "ä¸æœ½è‹±é›„", "å‚³èªªåŠè–", "æ•¸å­¸æˆ°ç¥"];
    
    const stories = {
        true: [
            "ã€æ‘èŠå¹³æ°‘ã€‘{name}å›åˆ°äº†å®¶é„‰ï¼Œçœ‹è¦‹éš”å£é›œè²¨åº—è€é—†æ­£ç‚ºäº†ç®—ä¸æ¸…å¹¾ç±ƒé›è›‹çš„ç¸½æ•¸è€Œæ€¥å¾—æ»¿é ­å¤§æ±—ã€‚{name}å¤§æ­¥è·¨ä¸Šå‰ï¼Œåƒ…ç”¨ä¸€çœ¼å°±å¹«è€é—†ç®—å‡ºäº†æ­£ç¢ºç­”æ¡ˆã€‚è€é—†æ„Ÿæ¿€è¬åˆ†ï¼Œé€äº†{name}ä¸€ç±ƒç‰¹å¤§è™Ÿé›è›‹ä½œç‚ºå›ç¦®ã€‚{name}ç¬¬ä¸€æ¬¡ç™¼ç¾ï¼ŒåŸä¾†å­¸å¥½åŠ æ³•å¯ä»¥å¹«åŠ©é€™éº¼å¤šäººï¼Œå…¨æ‘çš„äººéƒ½åœ¨é–€å£ç‚ºä½ æ­¡å‘¼å–é‡‡ï¼Œé€™æ„Ÿè¦ºçœŸæ˜¯å¤ªæ£’äº†ï¼",
            "ã€æ–°å…µæˆ°å£«ã€‘åœ¨å……æ»¿æ±—æ°´çš„æ¼”æ­¦å ´ï¼Œæ•™å®˜é»åè¦æ¸…é»å—æçš„å¯¶åŠã€‚åŸæœ¬æœ‰å…©ç™¾æ”¯ç·´ç¿’åŠï¼Œå»è¢«ç²—é­¯çš„æ–°å…µå€‘å¼„å£äº†å››åå…«æ”¯ï¼Œæ•™å®˜å¤§å¼å•å‰©ä¸‹å¤šå°‘ã€‚{name}ä¸æ€¥ä¸å¾åœ°çµ¦å‡ºäº†æ­£ç¢ºç­”æ¡ˆï¼Œè®“æ•™å®˜åŸæœ¬æº–å‚™å¥½çš„è™•ç½°é€šé€šå–æ¶ˆã€‚æˆ°å‹å€‘ç´›ç´›å°{name}è±èµ·å¤§æ‹‡æŒ‡ï¼Œç›´èªªä½ çš„è…¦è¢‹æ¯”ç›¾ç‰Œé‚„è¦ç¡¬ã€é‚„è¦å¯é ï¼",
            "ã€åµæŸ¥å°éšŠã€‘{name}æ½›ä¼åœ¨èŒ‚å¯†çš„æ£®æ—ï¼Œå¿…é ˆç®—å‡ºæ•µç‡Ÿä¸­æ‰€æœ‰ç‡Ÿç«çš„ç¸½æ•¸ã€‚æ¯å€‹ç‡Ÿå€æœ‰ä¹å †ç«ï¼Œç¸½å…±æœ‰ä¸ƒå€‹ç‡Ÿå€ï¼Œ{name}åœ¨å¿ƒè£¡é»˜å”¸ä¹ä¹ä¹˜æ³•ï¼Œä¸‰ç§’é˜å°±æ¨æ–·å‡ºæ•µæ–¹çš„è¦æ¨¡ã€‚å› ç‚ºé€™ä»½ç¥é€Ÿçš„æƒ…å ±ï¼Œæˆ‘æ–¹è»éšŠåŠæ™‚æ’¤é€€é¿é–‹äº†åŸ‹ä¼ã€‚éšŠé•·ç¨±è®š{name}æ˜¯å…¨è»æœ€éˆæ´»çš„åµæŸ¥çœ¼ï¼Œæœªä¾†çš„å°‡è»ä¹‹ä½ä¸€å®šæœ‰ä½ çš„ä»½ï¼",
            "ã€é‡è£è¡›å…µã€‘åŸé–€å£è¦è£è¨­å¨åŠ›å·¨å¤§çš„é‡å‹å¼©ç‚®ï¼Œ{name}è² è²¬åˆ†é…ç‚®å½ˆçš„ç¸½é‡é‡ã€‚æ¯ä¸€å°å¼©ç‚®é‡é”å››åäº”å…¬æ–¤ï¼Œç¸½å…±è¦æ¶è¨­å…«å°ï¼Œé€™æ±ºå®šäº†åŸç‰†æ˜¯å¦èƒ½æ‰¿å—å¾—ä½è¡æ“Šã€‚{name}åœ¨æ²™åœ°ä¸Šç•«äº†å¹¾ç­†ï¼Œè¿…é€Ÿç®—å‡ºäº†ç²¾ç¢ºæ•¸å€¼ã€‚æˆ°å‹å€‘çœ‹è‘—ç©©å¦‚æ³°å±±çš„åŸé–€ï¼Œæ·±æ„Ÿæœ‰{name}åœ¨ï¼Œå¤§å®¶ä»Šæ™šå°±èƒ½å®‰å¿ƒåœ¨ç‡Ÿç«æ—ç¡å€‹å¥½è¦ºäº†ï¼",
            "ã€ç™¾äººéšŠé•·ã€‘{name}çµ±å¸¥ä¸€ç™¾åç²¾è‹±æˆ°å£«é å¾ï¼Œé‡åˆ°éœ€è¦åˆ†é…è¡Œè»å£ç³§çš„é—œéµæ™‚åˆ»ã€‚æ¯è¢‹å£ç³§ä¸‰åäºŒå…¬æ–¤ï¼Œç¸½å…±è¦å¹³å‡åˆ†çµ¦åäºŒå€‹å°éšŠï¼Œé€™è¤‡é›œçš„ç®—è¡“è®“å‰¯å®˜ç®—åˆ°é ­å†’è¼•ç…™ã€‚ä½†{name}æ‹æ‹å‰¯å®˜çš„è‚©è†€ï¼Œè¼•é¬†å”¸å‡ºäº†æ­£ç¢ºçµæœã€‚å£«å…µå€‘å´‡æ‹œåœ°çœ‹è‘—{name}ï¼Œå¿ƒè£¡ç„¡æ¯”è¸å¯¦ï¼šè·Ÿè‘—é€™éº¼è°æ˜çš„éšŠé•·ï¼Œçµ•å°ä¸æœƒåœ¨å¤–é¢é¤“è‚šå­ï¼",
            "ã€ç‹å®®ä¾è¡›ã€‘ç‹å®®çš„åœ°æ¿å—æäº†ï¼Œåœ‹ç‹è¦ªè‡ªè«‹{name}ç®—å‡ºè¦è³¼è²·å¤šå°‘å¡Šæ˜‚è²´çš„å¤§ç†çŸ³åœ°ç£šã€‚é€™æ˜¯ä¸€å€‹é¾å¤§çš„é™¤æ³•å·¥ç¨‹ï¼Œç¨å¾®ç®—éŒ¯ä¸€å¡Šï¼Œåœ‹ç‹èµ°è·¯å°±æœƒè¢«çµ†å€’ã€‚ç•¶æœ€å¾Œä¸€å¡Šåœ°ç£šå®Œç¾å¡«å…¥ï¼Œæ²’æœ‰ä»»ä½•ä¸€çµ²ç¸«éš™æ™‚ï¼Œåœ‹ç‹é«˜èˆˆåœ°æ‘˜ä¸‹ç‹å† å‘{name}è‡´æ„ã€‚{name}å¾®ç¬‘è‘—ï¼Œä»–çµ‚æ–¼é«”æœƒåˆ°æ•¸å­¸å¸¶ä¾†çš„å®Œç¾å¹³è¡¡æ„Ÿï¼",
            "ã€æ¦®è€€é¨å£«ã€‘{name}åœ¨é å¾é€”ä¸­é‡åˆ°äº†ä¸€å€‹éš¾é¢˜ï¼šè¦æŠŠäº”ç™¾å¡ŠéºµåŒ…å¹³åˆ†çµ¦äºŒåäº”ä½å—ç½çš„æ‘æ°‘ï¼Œå‰©ä¸‹çš„é¤˜æ•¸è¦æ€éº¼è™•ç†ï¼Ÿé€™è€ƒé©—è‘—é¨å£«çš„å…¬æ­£èˆ‡æ™ºæ…§ã€‚{name}å†·éœç®—å‡ºç­”æ¡ˆï¼Œä¸¦å°‡å‰©ä¸‹çš„éºµåŒ…åˆ†çµ¦äº†è·¯é‚Šæœ€ç˜¦å°çš„å­©å­ã€‚å¤§å®¶å°é¨å£«çš„æ™ºæ…§æ„Ÿä½©ä¸å·²ï¼Œ{name}è¦ºå¾—ï¼Œæ•¸å­—åœ¨å¥½äººæ‰‹è£¡ï¼Œå°±æ˜¯å®ˆè­·æ­£ç¾©çš„æœ€å¼·ç›¾ç‰Œï¼",
            "ã€å·¨é¾å°‡è»ã€‘åœ¨é«˜ç©ºé›²å±¤ä¸­ï¼Œ{name}é§•é¦­è‘—å™´ç«å·¨é¾ï¼Œå¿…é ˆéš¨æ™‚è¨ˆç®—å¼·é¢¨èˆ‡æ°£å£“çš„æ¯”å€¼ã€‚é€™æ˜¯ä¸€å€‹æ¥µé«˜é›£åº¦çš„é™¤æ³•èˆ‡é¤˜æ•¸æŒ‘æˆ°ï¼Œç¨å¾®ç®—éŒ¯å°±æœƒå¾å¹¾åƒå…¬å°ºçš„é«˜ç©ºæ‰ä¸‹å»ã€‚{name}ç›¯è‘—é¢¨é€Ÿè¨ˆï¼Œè…¦è¢‹è½‰å¾—æ¯”å·¨é¾çš„ç¿…è†€é‚„è¦å¿«ï¼Œæœ€çµ‚ç²¾æº–é™è½åœ¨æ¨™é¶å¡”å°–ã€‚å…¨åŸçš„å·¨é¾éƒ½åœ¨ç‚º{name}çš„æ™ºæ…§å’†å“®å–é‡‡ï¼Œå ´é¢å£¯è§€åˆ°è®“äººæµæ·šï¼",
            "ã€ä¸æœ½è‹±é›„ã€‘{name}èµ°é€²äº†å‚³èªªä¸­çš„é‚è¼¯ä¹‹å¡”ï¼Œé¢å‰æ˜¯æ©«è·¨æ•´é¢ç‰†çš„å…«é …é•·å¼å°å°ã€‚é€™æ˜¯ä¸€å ´èˆ‡å¤è€æ™ºæ…§çš„å·”å³°æ±ºé¬¥ï¼ŒåŠ æ¸›ä¹˜é™¤äº¤ç¹”æˆç¶²ï¼Œç¨æœ‰ä¸æ…å°±æœƒè¿·å¤±ã€‚{name}é–‰ä¸Šé›™çœ¼ï¼Œè®“æ•¸å­—åœ¨è…¦æµ·ä¸­è·³èˆï¼Œé€ä¸€æ‹†è§£å°å°ï¼Œæœ€çµ‚é‡‘å…‰å¤§ä½œï¼ç‹åœ‹ä¸€åŠçš„éœ§éœ¾ç¬é–“æ¶ˆå¤±ã€‚{name}åœ¨è¬äººæ¨å´‡ä¸­ï¼Œæˆç‚ºäº†æ­·å²æ›¸ä¸Šæ°¸æ†çš„è‹±é›„ï¼",
            "ã€æ•¸å­¸æˆ°ç¥ã€‘è«¸ç¥é»ƒæ˜é™è‡¨ï¼Œä¸–ç•Œé™·å…¥äº†æ··äº‚çš„æ•¸å­—é»‘æ´ä¸­ã€‚{name}é¢å°é‚£é€£ç¥æ˜éƒ½ç„¡æ³•å¿ƒç®—çš„åé …å·¨å‹ç¥å¼ï¼Œçœ¼ä¸­é–ƒçˆè‘—å¹³éœçš„å…‰èŠ’ã€‚ä»–åƒæ˜¯ä¸€ä½å„ªé›…çš„æŒ‡æ®å®¶ï¼Œåœ¨è™›ç©ºä¸­åŠƒä¸‹æœ€çµ‚è§£ç­”ã€‚é»‘æ´æ¶ˆå¤±äº†ï¼Œæ˜Ÿè¾°é‡æ­¸è»Œé“ï¼Œ{name}çš„åå­—æ°¸é åˆ»åœ¨äº†å®‡å®™çš„ç§©åºæ ¸å¿ƒã€‚ä»–æ˜¯ç•¶ä¹‹ç„¡æ„§çš„â€”â€”æ•¸å­¸æˆ°ç¥ï¼"
        ],
        false: [
            "ã€å‡çš„æ‘èŠå¹³æ°‘ã€‘{name}æ‹¿è‘—å¾é„°å±…é‚£è£¡å€Ÿä¾†çš„å‡ç¨±è™Ÿå»å¹«å¿™ç®—å¸³ï¼ŒçµæœæŠŠã€äº”é¡†è˜‹æœåŠ ä¸‰é¡†ã€ç®—æˆäº†ã€äº”ç™¾ä¸‰åå…«é¡†ã€ï¼Œè€é—†ä»¥ç‚ºä½ æ˜¯ä¾†æ¶åŠ«çš„ï¼Œæ°£å¾—æ‹¿æƒå¸šè¿½è‘—ä½ è·‘äº†ä¸‰æ¢è¡—ã€‚{name}ä¸€é‚Šè·‘ä¸€é‚Šæ‰å‡ºä½œå¼Šçš„å°æŠ„ï¼Œå…¨æ‘çš„å°ç‹—éƒ½è·Ÿåœ¨å¾Œé¢å˜²ç¬‘ä½ ï¼Œé€™ä¸‹ä½ æˆäº†å…¨æ‘æœ€æœ‰åçš„ã€æ•¸å­¸å°ä¸‘ã€å•¦ï¼",
            "ã€å‡çš„æ–°å…µæˆ°å£«ã€‘{name}åœ¨æ¼”æ­¦å ´è€ƒè©¦æ™‚å·çœ‹è§£ç­”ï¼ŒçµæœæŠ„éŒ¯è¡Œï¼ŒæŠŠå‰©ä¸‹çš„ã€ä¸ƒåä¸ƒæ”¯åŠã€å ±æˆäº†ã€å‰©ä¸‹ä¸ƒåä¸ƒè¬éš»å¤§è±¡ã€ã€‚æ•™å®˜æ°£å¾—è‡‰éƒ½é»‘äº†ï¼ŒæŒ‡è‘—ç©ºè•©è•©çš„è‰åœ°å•ï¼šã€å¤§è±¡åœ¨å“ªè£¡ï¼Ÿä½ çµ¦æˆ‘è®Šå‡ºä¾†ï¼ã€{name}åš‡å¾—èº²é€²è‰å¢è£¡ï¼Œçµæœå±è‚¡è¢«ä»™äººæŒåˆºå¾—å“‡å“‡å¤§å«ï¼Œé€™å†’ç‰Œè²¨çš„ä¸‹å ´çœŸæ˜¯å¤ªæ…˜äº†ï¼",
            "ã€å‡çš„åµæŸ¥å°éšŠã€‘{name}æ‹¿è‘—å°éŒ¯çš„ä¹ä¹ä¹˜æ³•è¡¨å»åµæŸ¥æ•µäººæ•¸é‡ï¼ŒçµæœæŠŠã€ä¸ƒå€‹æ•µäººã€ç®—æˆäº†ã€ä¸ƒè¬å€‹å¤–æ˜Ÿè»éšŠã€ï¼Œåš‡å¾—å…¨è»é€£å¤œæ’¤é€€è·‘äº†äº”åå…¬é‡Œï¼Œæœ€å¾Œæ‰ç™¼ç¾å°æ–¹åªæœ‰ä¸€å€‹äººåœ¨ç”Ÿç«çƒ¤åœ°ç“œã€‚åœ‹ç‹ç½°{name}å»å¹«é‚£å€‹çƒ¤åœ°ç“œçš„äººæ•¸ä¸€è¬é¡†åœ°ç“œï¼Œä¸èƒ½ç”¨ç®—çš„åªèƒ½ç”¨è·³çš„æ•¸ï¼Œå…¨åŸçš„äººéƒ½ä¾†çœ‹ä½ è·³èˆï¼",
            "ã€å‡çš„é‡è£è¡›å…µã€‘{name}ç©¿è‘—å¤§åˆ°ä¸åˆèº«çš„å‡ç›”ç”²å»ç®—å¼©ç‚®é‡é‡ï¼Œçµæœå› ç‚ºé‡å¿ƒç®—éŒ¯ï¼Œæ•´å€‹äººåƒå€‹åœ“æ»¾æ»¾çš„éµç½é ­ä¸€æ¨£å¾€å¾Œæ‘”ï¼Œä¸€è·¯æ»¾åˆ°äº†è­·åŸæ²³è£¡ã€‚å¤§å®¶æŠŠä½ æ’ˆèµ·ä¾†çš„æ™‚å€™ï¼Œæ‰ç™¼ç¾ä½ ç›”ç”²è£¡å¡çš„ä¸æ˜¯éµç‰‡è€Œæ˜¯è»Ÿç¶¿ç¶¿çš„æ£‰èŠ±ç³–ã€‚{name}åœ¨å¤§å®¶çš„ç¬‘è²ä¸­ç´…è‘—è‡‰é€ƒè·‘ï¼ŒçœŸæ˜¯ä¸Ÿè‡‰ä¸Ÿåˆ°å¤–å¤ªç©ºå»äº†ï¼",
            "ã€å‡çš„ç™¾äººéšŠé•·ã€‘{name}åœ¨å¤§è»é¢å‰æƒ³è¦è€å¸¥ç”¨å¿ƒç®—åˆ†å£ç³§ï¼ŒçµæœæŠŠã€åˆ†éºµåŒ…ã€ç®—æˆäº†ã€åˆ†çŸ³é ­ã€ï¼Œè®“é£¢é¤“çš„å£«å…µå€‘æ‹¿åˆ°ä¸€å †éµåµçŸ³ã€‚å¤§å®¶æ°£å¾—æŠŠ{name}èˆ‰èµ·ä¾†ä¸Ÿé€²æ± å¡˜è£¡é¤µé­šã€‚{name}åœ¨æ°´è£¡åè‘—æ³¡æ³¡ï¼Œé‚„åœ¨æƒ³ç‚ºä»€éº¼è‡ªå·±çš„ä½œå¼ŠæŒ‰éˆ•å¤±éˆäº†ï¼Œé€™ä¸‹å…¨ç‹åœ‹éƒ½çŸ¥é“ä½ æ˜¯å€‹æ„›ä½œå¼Šçš„å‡éšŠé•·å•¦ï¼",
            "ã€å‡çš„ç‹å®®ä¾è¡›ã€‘{name}æ··é€²ç‹å®®å¹«å¿™é‹ªåœ°ç£šï¼Œçµæœç®—éŒ¯é¢ç©ï¼Œåœ°ç£šå…¨éƒ¨ç–Šåœ¨ä¸€èµ·è®Šæˆäº†ä¸€åº§å°å±±ï¼Œå·®é»æŠŠè·¯éçš„åœ‹ç‹åŸ‹æ‰ã€‚åœ‹ç‹çœ‹è‘—ä½ çš„å‡è­‰ä»¶ï¼Œç¬‘è‘—æŠŠä½ è®Šæˆäº†ä¸€å°Šæœƒå™´æ°´çš„é›•åƒæ”¾åœ¨åŸé–€å£ã€‚{name}ç¾åœ¨æ¯å¤©éƒ½è¦è¢«è·¯éçš„å°è²“æŠ“ç™¢å»ä¸èƒ½å‹•ï¼Œé€™å°±æ˜¯æ„›ä½œå¼Šçš„æç¬‘ä»£åƒ¹ï¼Œå¤ªæ»‘ç¨½äº†ï¼",
            "ã€å‡çš„æ¦®è€€é¨å£«ã€‘{name}åœ¨å¤§è¡—ä¸Šå‡è£å…¬æ­£åˆ†é¤…ä¹¾çµ¦é›£æ°‘ï¼Œçµæœç®—éŒ¯é¤˜æ•¸ï¼ŒæŠŠæ‰€æœ‰çš„é¤…ä¹¾éƒ½ç®—é€²äº†è‡ªå·±çš„å˜´å·´è£¡ã€‚ä»–é‚„å°å¤§å®¶èªªï¼šã€é€™æ˜¯åœ¨æ¸¬è©¦é¤…ä¹¾æœ‰æ²’æœ‰æ¯’ï¼ã€çµæœå‰›èªªå®Œï¼Œå˜´è£¡çš„ä½œå¼Šç´™æ¢å°±å™´äº†å‡ºä¾†ï¼Œç›´æ¥è²¼åœ¨é›£æ°‘çš„è‡‰ä¸Šã€‚{name}å°·å°¬åˆ°æƒ³ç›´æ¥é‘½é€²åœ°æ´è£¡æ¶ˆå¤±ï¼Œå¤§å®¶ç¬‘åˆ°è‚šå­å¥½ç—›ï¼",
            "ã€å‡çš„å·¨é¾å°‡è»ã€‘{name}çˆ¬ä¸Šé¾èƒŒæƒ³è¦ä½œå¼Šè¨ˆç®—é£›è¡Œé«˜åº¦ï¼Œçµæœæ‰‹æ±—æŠŠä½œå¼Šæ¢å¼„å¾—æ¿•ç³Šç³Šçš„æ ¹æœ¬çœ‹ä¸æ¸…ã€‚ä»–éš¨ä¾¿å–Šäº†ä¸€å€‹åº§æ¨™ï¼Œç«é¾ç›´æ¥è¼‰è‘—ä»–è¡é€²äº†çš‡å®®çš„å…¬å…±å»æ‰€è£¡ã€‚{name}æ›è‘—ä¸€é ­æ²ç­’è¡›ç”Ÿç´™çˆ¬å‡ºä¾†æ™‚ï¼Œæ‰€æœ‰çš„é¾éƒ½ç¬‘åˆ°å·®é»å™´ç«ï¼Œé€™çµ•å°æ˜¯ç‹åœ‹å²ä¸Šæœ€è‡­ã€æœ€çˆ†ç¬‘çš„å·¨é¾å†’éšªäº†ï¼",
            "ã€å‡çš„ä¸æœ½è‹±é›„ã€‘{name}èµ°é€²é‚è¼¯ä¹‹å¡”ï¼Œè©¦åœ–ç”¨ç¦å¿Œå’’èªè·³éæ‰€æœ‰é—œå¡ã€‚æ²’æƒ³åˆ°å¡”éˆæ—©å°±ç™¼ç¾äº†ï¼Œæ•…æ„æŠŠé¡Œç›®è®Šæˆäº†ã€1åŠ 1ç­‰æ–¼å¤šå°‘ã€ã€‚{name}å› ç‚ºå¤ªç·Šå¼µå¤§å–Šï¼šã€ä¹åä¹å…†ï¼ã€ã€‚å¡”éˆå˜†äº†ä¸€å£æ°£ï¼ŒæŠŠ{name}è®Šæˆäº†ä¸€éš»ç©¿è‘—èŠ­è•¾èˆè£™çš„æ²³é¦¬ï¼Œé€ä»–åœ¨ç‹åŸå»£å ´è·³èˆä¸‰å¤©ä¸‰å¤œï¼Œå…¨åŸéƒ½ç˜‹ç‹‚æ‹ç…§ç•™å¿µï¼",
            "ã€å‡çš„æ•¸å­¸æˆ°ç¥ã€‘{name}åœ¨å¤§å…¸ä¸Šå®£ç¨±è‡ªå·±ç®—ç„¡éºç­–ï¼Œçµæœåœ‹ç‹è«‹ä»–ç®—ã€10æ¸›10ç­‰æ–¼å¤šå°‘ã€ï¼Œä»–ç«Ÿç„¶ç›¯è‘—è…³è¶¾ç®—äº†åŠå€‹å¤šå°æ™‚ï¼Œæœ€å¾Œå¤§è²å›ç­”ï¼šã€ç­‰æ–¼ä¸€å€‹é›è›‹é¤…ï¼ã€ã€‚å…¨å ´ç¬é–“çˆ†ç™¼å‡ºå²ä¸Šæœ€å¤§çš„ç¬‘è²ã€‚åŸä¾†ä½ çš„æˆ°ç¥è²¼ç´™æ˜¯å»é›œè²¨åº—è²·ä¸€é€ä¸€æ›ä¾†çš„ï¼Œé€™çœŸæ˜¯ç‹åœ‹æ­·å²ä¸Šæœ€å‰å¤§çš„æç¬‘å‚³èªªï¼"
        ]
    };

    let curLvl = 0, targetAns = 0, targetRem = 0, streak = 0, times = [], startTime, activeInput = 'main', isCheated = false;

    function startGame() { document.getElementById('prologueOverlay').style.display = 'none'; generate(); }

    function updateRankBoard() {
        const list = document.getElementById('rankListDisplay');
        const p = isCheated ? "å‡çš„" : ""; 
        list.innerHTML = heroes.map((h, i) => `<li class="rank-item ${i === curLvl ? 'active' : ''}">${i}.${p}${h}</li>`).join('');
    }

    function generate() {
        const lvl = levels[curLvl];
        document.getElementById('lvlStatus').innerText = (isCheated ? "å‡çš„" : "") + heroes[curLvl];
        document.getElementById('levelTitle').innerText = lvl.name;
        document.getElementById('goalCond').innerText = `${lvl.fast[0]}s/${lvl.fast[1]}å‹ æˆ– ${lvl.slow[0]}s/${lvl.slow[1]}å‹`;
        document.getElementById('remainderZone').style.display = lvl.type.includes('Rem') ? 'block' : 'none';
        
        let qText = "", n1, n2;
        switch(lvl.type) {
            case "mix_9": let r9 = buildProExpr(8, 50, 250); qText = r9.q; targetAns = r9.a; break;
            case "mix_10": let r10 = buildProExpr(10, 500, 999); qText = r10.q; targetAns = r10.a; break;
            case "divExact": do { n2 = rand(3, 16); } while (n2 % 5 === 0); targetAns = rand(11, 40); n1 = n2 * targetAns; qText = `${n1} Ã· ${n2}`; break;
            case "divRem1": do { n2 = rand(6, 25); } while (n2 % 5 === 0); n1 = rand(50, 250); targetAns = Math.floor(n1/n2); targetRem = n1%n2; qText = `${n1} Ã· ${n2}`; break;
            case "divRem2": do { n2 = rand(16, 51); } while (n2 % 5 === 0); n1 = rand(300, 1500); targetAns = Math.floor(n1/n2); targetRem = n1%n2; qText = `${n1} Ã· ${n2}`; break;
            case "add": n1 = rand(10, 99); n2 = rand(10, 99); qText = `${n1}+${n2}`; targetAns = n1+n2; break;
            case "sub": n1 = rand(100, 300); n2 = rand(10, 99); qText = `${n1}-${n2}`; targetAns = n1-n2; break;
            case "multi99": n1 = rand(4, 9); n2 = rand(4, 9); qText = `${n1}Ã—${n2}`; targetAns = n1*n2; break;
            case "multi2x1": n1 = rand(21, 99); n2 = rand(3, 9); qText = `${n1}Ã—${n2}`; targetAns = n1*n2; break;
            case "multi2x2": n1 = rand(11, 49); n2 = rand(11, 39); qText = `${n1}Ã—${n2}`; targetAns = n1*n2; break;
        }
        document.getElementById('questionDisplay').innerText = qText;
        document.getElementById('ansMain').value = ""; document.getElementById('ansRem').value = "";
        activeInput = 'main'; updateInputFocus(); startTime = Date.now(); updateRankBoard();
    }

    function buildProExpr(count, min, max) {
        let ops = ['+', '-', '*'], expr = [rand(min, max)];
        for(let i=1; i<count; i++) {
            let op = ops[rand(0, 2)];
            let val = (op === '*') ? rand(2, 6) : rand(min, max);
            expr.push(op); expr.push(val);
        }
        let s = expr.join(' ');
        return { q: s.replace(/\*/g, 'Ã—'), a: eval(s) };
    }

    function pressKey(k) {
        let t = (activeInput === 'main') ? document.getElementById('ansMain') : document.getElementById('ansRem');
        if (k === 'C') t.value = ""; else t.value += k;
    }

    function check() {
        const uA = parseInt(document.getElementById('ansMain').value), uR = parseInt(document.getElementById('ansRem').value || 0);
        const dur = (Date.now() - startTime) / 1000;
        let ok = (uA === targetAns);
        if (levels[curLvl].type.includes('Rem')) ok = (ok && uR === targetRem);

        if (ok) {
            streak++; times.push(dur);
            const avg = (times.reduce((a,b)=>a+b,0)/times.length).toFixed(1);
            document.getElementById('avgTime').innerText = avg;
            showFb("é­”æ³•æ ¸å‡†", "var(--neon-green)");
            if ((streak >= levels[curLvl].fast[1] && avg <= levels[curLvl].fast[0]) || (streak >= levels[curLvl].slow[1] && avg <= levels[curLvl].slow[0])) upgrade();
        } else {
            streak = 0; times = []; document.getElementById('avgTime').innerText = "0";
            showFb("é­”åŠ›æ’æ–¥", "var(--neon-red)");
        }
        document.getElementById('streak').innerText = streak; generate();
    }

    function execCheat() { isCheated = true; updateRankBoard(); document.getElementById('ansMain').value = targetAns; document.getElementById('ansRem').value = targetRem || 0; setTimeout(() => { upgrade(); generate(); }, 200); }

    function upgrade() { if (curLvl < levels.length - 1) { curLvl++; streak = 0; times = []; alert("ç­‰ç´šæ™‰å‡ï¼"); } else { alert("æˆå°±é”æˆï¼šç§©åºä¸»å®°è€…ï¼"); location.reload(); } }

    function openRest() { document.getElementById('modal').style.display = 'flex'; }
    function confirmRest() {
        const nameVal = document.getElementById('playerName').value || "ä½šåå‹‡è€…";
        document.getElementById('inputArea').style.display = 'none';
        document.getElementById('restStory').style.display = 'block';
        document.getElementById('modalBtn').innerText = "é—œé–‰å­˜æª”æ—¥è¨˜";
        document.getElementById('modalBtn').onclick = () => location.reload();
        
        let storyTemplate = stories[(!isCheated).toString()][curLvl];
        let finalStr = storyTemplate.split("{name}").join(`<b>${nameVal}</b>`);
        document.getElementById('restStory').innerHTML = finalStr;
    }

    function updateInputFocus() { document.getElementById('ansMain').classList.toggle('active', activeInput === 'main'); document.getElementById('ansRem').classList.toggle('active', activeInput === 'rem'); }
    document.getElementById('ansMain').onclick = () => { activeInput = 'main'; updateInputFocus(); };
    document.getElementById('ansRem').onclick = () => { activeInput = 'rem'; updateInputFocus(); };
    function showFb(t, c) { const f = document.getElementById('feedback'); f.innerText = t; f.style.color = c; }
    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
</script>
</body>
</html>