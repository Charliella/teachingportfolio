<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•†æˆ°å·¨é ­ï¼šæ•¸å­—ä½µè³¼æˆ° Final Ultra</title>
    <style>
        :root {
            --neon-green: #00ff41; --neon-gold: #f1c40f; --neon-red: #ff3e3e;
            --neon-blue: #00d2ff; --bg-dark: #0a0a0b;
        }

        * { box-sizing: border-box; }
        html, body { 
            height: 100vh; width: 100vw; margin: 0; padding: 0; 
            overflow: hidden; background-color: var(--bg-dark);
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; color: #fff;
        }

        /* éŠæˆ²æ¡†æ¶ä½ˆå±€ */
        .game-wrapper {
            display: grid;
            grid-template-columns: 1fr 220px; 
            grid-template-rows: 10vh 1fr 35vh;
            gap: 1.5vh;
            height: 100vh;
            padding: 2vh;
        }

        .level-header {
            grid-column: 1 / 2;
            background: rgba(0, 210, 255, 0.15);
            border-left: 12px solid var(--neon-blue);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 2vw;
        }
        .level-header h2 { margin: 0; font-size: 4vh; color: var(--neon-blue); }
        #feedback { font-size: 4vh; font-weight: 900; }

        /* å·¦å´ä¸»éŠæˆ²å€ */
        .main-content {
            grid-column: 1 / 2;
            display: flex; flex-direction: column; gap: 1vh;
            min-height: 0;
        }

        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1vw; }
        .stat-card { background: #1a1a1f; border: 1px solid #444; padding: 1vh; text-align: center; border-radius: 10px; }
        .stat-label { font-size: 1.8vh; color: #888; display: block; }
        .stat-value { font-size: 3.5vh; font-weight: bold; color: var(--neon-gold); }

        /* é¡Œç›®é¡¯ç¤ºï¼šä½µè³¼ç›®æ¨™æ•¸å­— */
        .question-display {
            flex-grow: 1; background: #000; border: 5px solid #333;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border-radius: 20px; position: relative;
        }
        .target-label { font-size: 3vh; color: var(--neon-blue); margin-bottom: 1vh; }
        #numDisplay {
            font-size: 14vh; font-weight: 900; color: var(--neon-gold);
            text-shadow: 0 0 40px rgba(241, 196, 15, 0.6);
        }

        /* ç¶²æ ¼é¸æ“‡å€ï¼šæ”¹ç‚º 4x4 */
        .game-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.2vh;
            padding: 1vh; background: #111; border-radius: 15px; height: 35vh;
        }
        .option-btn {
            background: #222; border: 2px solid #555; color: #fff;
            font-size: 4vh; font-weight: bold; cursor: pointer; border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            transition: 0.2s;
        }
        .option-btn.selected {
            background: var(--neon-blue); color: #000; border-color: #fff;
            box-shadow: 0 0 20px var(--neon-blue); transform: scale(0.95);
        }

        /* å³å´æ’è¡Œæ¦œ */
        .side-panel {
            grid-column: 2 / 3; grid-row: 1 / 4;
            background: #111; border: 2px solid var(--neon-gold);
            padding: 1.5vh 1vh; display: flex; flex-direction: column; border-radius: 15px;
        }
        .side-panel h3 { font-size: 2.2vh; color: var(--neon-gold); text-align: center; margin-bottom: 1.5vh; border-bottom: 1px solid var(--neon-gold); padding-bottom: 1vh; }
        .rank-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto; }
        .rank-item { padding: 0.8vh; font-size: 2.3vh; color: #555; border-bottom: 1px solid #222; }
        .rank-item.active { color: #fff; background: #333; font-weight: bold; border-left: 5px solid var(--neon-gold); }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls-row { grid-column: 1 / 2; display: grid; grid-template-columns: 1fr 1fr; gap: 2vw; margin-top: 1vh; }
        .action-btn {
            height: 12vh; font-size: 5vh; font-weight: 900; border: none; border-radius: 20px; cursor: pointer;
            color: #000; background: var(--neon-green); box-shadow: 0 5px 0 #008021;
        }
        .action-btn:active { transform: translateY(5px); box-shadow: none; }
        .special-btn { background: #333; color: #fff; font-size: 3vh; border: 2px solid #555; border-radius: 20px; cursor: pointer; }
        .cheat-btn { border-color: var(--neon-red); color: var(--neon-red); }

        /* æ•…äº‹å½ˆçª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); justify-content: center; align-items: center; z-index: 11000;
        }
        .modal-content {
            background: #111; border: 6px solid var(--neon-blue); padding: 5vh;
            width: 90vw; height: 90vh; display: flex; flex-direction: column; border-radius: 30px;
        }
        #restStory { 
            font-size: 4vh; color: #f0f0f0; line-height: 1.8; text-align: left; 
            overflow-y: auto; flex-grow: 1; margin: 3vh 0; padding: 4vh; 
            background: #050505; border-radius: 20px; border: 2px solid #333;
        }
        #restStory b { color: var(--neon-gold); font-size: 4.5vh; }
        #playerName { font-size: 6vh; width: 100%; padding: 2vh; background: #000; color: var(--neon-blue); border: 4px solid var(--neon-blue); margin-top: 2vh; text-align: center; border-radius: 15px; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex; justify-content: center; align-items: center;
            padding: 5vw; text-align: center;
        }
    </style>
</head>
<body>

<div id="prologueOverlay" class="overlay">
    <div style="max-width: 1000px;">
        <h1 style="font-size: 9vh; color: var(--neon-blue); margin-bottom: 4vh;">ğŸ’° å•†æˆ°ï¼šæ•¸å­—ä½µè³¼æ¡ˆ ğŸ’°</h1>
        <p style="font-size: 4vh; line-height: 1.6; color: #ccc;">è¯çˆ¾è¡—çš„é‡‘èç§©åºå´©æ½°äº†ï¼<br>ç¾åœ¨å”¯ä¸€èƒ½æ±ºå®šå…¬å¸åƒ¹å€¼çš„ï¼Œæ˜¯ä½ å°ã€Œå› å­çµæ§‹ã€çš„æ•éŠ³ç›´è¦ºã€‚<br><br><b>å¯¦ç¿’ç”Ÿï¼Œè«‹æ‰¾å‡ºæ­£ç¢ºçš„ä½µè³¼å°è±¡ï¼Œé‡çµ„é‡‘èç‹åœ‹ï¼</b></p>
        <button class="action-btn" style="padding: 2vh 10vw; height: auto;" onclick="startGame()">é€²å…¥äº¤æ˜“æ‰€</button>
    </div>
</div>

<div class="game-wrapper">
    <div class="level-header">
        <h2 id="levelTitle">MARKET LOADING...</h2>
        <div id="feedback" style="color: #666;">ANALYZING</div>
    </div>

    <div class="main-content">
        <div class="stats-row">
            <div class="stat-card"><span class="stat-label">è·ä½éšç´š</span><span class="stat-value" id="lvlStatus">å¯¦ç¿’ç”Ÿ</span></div>
            <div class="stat-card"><span class="stat-label">æ±ºç­–é€£å‹</span><span class="stat-value" id="streak">0</span></div>
            <div class="stat-card"><span class="stat-label">åˆ†æè€—æ™‚</span><span class="stat-value" id="avgTime">0</span>s</div>
            <div class="stat-card"><span class="stat-label">è‘£äº‹æœƒè¦æ±‚</span><span id="goalCond" style="font-size:1.8vh; color:#999;">-</span></div>
        </div>
        <div class="question-display">
            <div class="target-label">ç›®æ¨™ä½µè³¼å¸‚å€¼ (Target Capital)</div>
            <div id="numDisplay">--</div>
            <div style="color:var(--neon-blue); margin-top:1vh;">è«‹é¸æ“‡å…©å€‹å› å­ (Factors)</div>
        </div>
        <div class="game-grid" id="grid"></div>
    </div>

    <div class="side-panel">
        <h3>å…¨çƒç¶“ç†äººæ¦œå–®</h3>
        <ul class="rank-list" id="rankListDisplay"></ul>
    </div>

    <div class="controls-row">
        <button class="action-btn" onclick="verifyPair()">ç¢ºèªåŸ·è¡Œä½µè³¼</button>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1vh;">
            <button class="special-btn cheat-btn" onclick="execCheat()">å…§ç·šäº¤æ˜“(ä½œå¼Š)</button>
            <button class="special-btn" onclick="openRest()">ç”³è«‹é›¢è·</button>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--neon-blue); font-size: 7vh; margin:0; text-align:center;">ğŸ“‘ å•†æ¥­å†’éšªå­˜æª”æ—¥è¨˜</h2>
        <div id="inputArea">
            <p style="font-size: 4vh; margin: 2vh 0; text-align:center;">è«‹è¼¸å…¥åŸ·è¡Œé•·çš„å§“åï¼š</p>
            <input type="text" id="playerName" placeholder="ä¾‹å¦‚ï¼šåŸƒéš†é¦¬æ–¯å…‹">
        </div>
        <div id="restStory" style="display:none;"></div>
        <button class="action-btn" style="width:100%; height: 14vh; margin-top:2vh;" id="modalBtn" onclick="confirmRest()">ç¢ºèªç°½ç½²</button>
    </div>
</div>

<script>
    const levels = [
        { name: "L1ï¼šæ•¸å­—å•Ÿè’™", maxNum: 50, fMin: 2, fMax: 25, fast: [4, 3], slow: [8, 7] },
        { name: "L2ï¼šä¹ä¹åŸºç¤", maxNum: 100, fMin: 2, fMax: 50, fast: [4, 3], slow: [8, 7] },
        { name: "L3ï¼šç™¾ä½é€²éš", maxNum: 250, fMin: 3, fMax: 80, fast: [5, 3], slow: [10, 7] },
        { name: "L4ï¼šå› æ•¸æ„ŸçŸ¥", maxNum: 500, fMin: 4, fMax: 150, fast: [6, 3], slow: [12, 7] },
        { name: "L5ï¼šæ•¸å­—çµäºº", maxNum: 1000, fMin: 6, fMax: 250, fast: [8, 3], slow: [15, 7] },
        { name: "L6ï¼šåƒä½è¦–ç•Œ", maxNum: 3000, fMin: 11, fMax: 500, fast: [10, 3], slow: [20, 7] },
        { name: "L7ï¼šçµäººä¹‹çœ¼", maxNum: 8000, fMin: 15, fMax: 1000, fast: [12, 3], slow: [28, 7] },
        { name: "L8ï¼šè¬ä½ç¦åŸŸ", maxNum: 25000, fMin: 21, fMax: 3000, fast: [16, 3], slow: [40, 6] },
        { name: "L9ï¼šç¥ç´šç›´è¦º", maxNum: 100000, fMin: 51, fMax: 5000, fast: [20, 3], slow: [60, 6] }
    ];

    const heroes = ["å¯¦ç¿’å°ˆå“¡", "åŠ©ç†ç¶“ç†", "è³‡æ·±åˆ†æå¸«", "æŠ•è³‡ä¸»ç®¡", "å€åŸŸç¸½ç›£", "ç­–ç•¥å‰¯ç¸½", "æŠ€è¡“é•·CTO", "åŸ·è¡Œé•·CEO", "è·¨åœ‹è²¡é–¥é•·", "é‡‘èä¸»å®°"];

    const stories = {
        true: [
            "ã€å¯¦ç¿’å°ˆå“¡ã€‘{name}å‰›é€²å…¬å¸ï¼Œå°±æŠŠè¾¦å…¬å®¤è£¡äº‚æˆä¸€åœ˜çš„å ±è¡¨æ•´ç†å¾—äº•äº•æœ‰æ¢ã€‚è€ç¶“ç†çœ‹è‘—ä½ åƒ…æ†‘å¿ƒç®—å°±æŠ“å‡ºå°å¸³å–®ä¸Šçš„å› å­æ¼æ´ï¼Œé©šè¨åœ°æ”¾ä¸‹äº†å’–å•¡ã€‚{name}ä¸ä½†å¾—åˆ°äº†æ­£è·åˆç´„ï¼Œé‚„è¢«ç²å‡†æ¯å¤©å¯ä»¥å¤šé ˜ä¸€ä»½å…è²»çš„ä¸‰æ˜æ²»ã€‚é€™å°±æ˜¯å¯¦åŠ›çš„è­‰æ˜ï¼",
            "ã€åŠ©ç†ç¶“ç†ã€‘åœ¨æ¿€çƒˆçš„è‚¡æ±å¤§æœƒä¸Šï¼Œ{name}æŒºèº«è€Œå‡ºã€‚å¤§å®¶éƒ½åœ¨çˆ­è«–ä½µè³¼æ¡ˆçš„ä¼°å€¼ï¼Œä½ è¿…é€Ÿåœ¨ç™½æ¿ä¸Šå¯«ä¸‹äº†å®Œç¾çš„å› æ•¸å°ã€‚åŸæœ¬è³ªç–‘ä½ çš„å°æ‰‹å€‘ç¬é–“å•å£ç„¡è¨€ã€‚é‚£å¤©æ™šä¸Šï¼Œ{name}åœ¨æ›¼å“ˆé “çš„é ‚å±¤å¤§æ¨“å–è‘—é¦™æª³ï¼Œæ…¶ç¥ä½ çš„ç¬¬ä¸€å ´å•†æˆ°å‹åˆ©ï¼Œå…¨å…¬å¸çš„é›»è…¦è¢å¹•éƒ½é–ƒçˆè‘—ä½ çš„åå­—ï¼",
            "ã€è³‡æ·±åˆ†æå¸«ã€‘{name}è­˜ç ´äº†ä¸€å ´é‡‘èé¨™å±€ã€‚å°æ–¹è©¦åœ–ç”¨è™›å‡çš„æ§“æ¡¿å€æ•¸ä¾†å”¬å¼„æŠ•è³‡äººï¼Œä½†{name}ä¸€çœ¼å°±çœ‹å‡ºé‚£å€‹æ•¸å­—æ ¹æœ¬æ²’æœ‰ä½ æ‰€é¸çš„å› æ•¸ã€‚å› ç‚ºé€™æ¬¡æ‹¯æ•‘ï¼Œä½ è¢«å‡è·åˆ°å°ˆå±¬è¾¦å…¬å®¤ã€‚ç¾åœ¨å…¨è¯çˆ¾è¡—éƒ½åœ¨æµå‚³ï¼Œåªè¦{name}çœ‹éçš„æ•¸å­—ï¼Œå°±çµ•å°è—ä¸ä½ç§˜å¯†ï¼",
            "ã€æŠ•è³‡ä¸»ç®¡ã€‘ä¸€å ´é«˜é”äº”å„„ç¾å…ƒçš„æŠ•è³‡æ¡ˆå°±åœ¨{name}æ‰‹ä¸­ã€‚ä½ éœ€è¦å¿«é€Ÿåˆ¤æ–·è³‡ç”¢é‡çµ„çš„æ¯”ä¾‹ï¼Œå…©ç§’é˜å…§ï¼Œä½ é»é¸äº†æ­£ç¢ºçš„å…©å®¶å­å…¬å¸ã€‚æŠ•è³‡æ¡ˆå®Œç¾å¥‘åˆï¼Œåˆ©æ½¤ç¿»äº†ä¸‰å€ï¼{name}çš„åå­—ç™»ä¸Šäº†ã€Šå¯Œæ¯”å£«ã€‹é›œèªŒçš„å°é¢ï¼Œå¤§å®¶éƒ½èªªä½ æ˜¯å…·æœ‰ã€æ•¸å­—ç³å­”ã€çš„å¤©æ‰ä¸»ç®¡ï¼",
            "ã€å€åŸŸç¸½ç›£ã€‘{name}æ¥ç®¡äº†æ•´å€‹äºæ´²å€çš„æ¥­å‹™ã€‚åœ¨ä¸€å ´ä¸­å¤–åˆè³‡çš„æœƒè­°ä¸­ï¼Œå°æ–¹å‡ºçš„æ•¸å­¸é¡Œæ„åœ–åˆé›£ï¼Œä½†ä½ ç”šè‡³ä¸ç”¨è¨ˆç®—æ©Ÿï¼Œç›´æ¥åœ¨é¤å·¾ç´™ä¸Šç•«å‡ºäº†å› æ•¸åœ–æ¡ˆã€‚å°æ–¹ç¸½è£èµ·ç«‹ç‚ºä½ é¼“æŒï¼Œä¸¦ç°½ä¸‹äº†åå¹´é•·ç´„ã€‚{name}ååœ¨ç§äººå™´å°„æ©Ÿä¸Šï¼Œæ„Ÿå—è‘—æ•¸æ“šæµéæŒ‡å°–çš„å¿«æ„Ÿï¼",
            "ã€ç­–ç•¥å‰¯ç¸½ã€‘å¸‚å ´ç™¼ç”Ÿäº†åŠ‡çƒˆæ³¢å‹•ï¼Œæ•¸å­—åƒç€‘å¸ƒä¸€æ¨£ç‹‚ç€‰ã€‚{name}å†·éœåœ°åœ¨æ ¸å¿ƒæ©Ÿæˆ¿ä¸‹é”ä½µè³¼æŒ‡ä»¤ï¼Œæ¯ä¸€çµ„å› æ•¸å°éƒ½ç²¾æº–é–å®šäº†å´©ç›¤é»ã€‚å› ç‚ºä½ çš„æ±ºæ–·ï¼Œå…¬å¸ä¸åƒ…æ²’è™§æï¼Œé‚„åä½µäº†ä¸‰å®¶ç«¶çˆ­å°æ‰‹ã€‚{name}ç¾åœ¨åœ¨å…¬å¸çš„å¨ä¿¡ï¼Œå·²ç¶“è¶…è¶Šäº†é‚£äº›åªæœƒçœ‹è²¡å ±çš„è€å¤è‘£ï¼",
            "ã€æŠ€è¡“é•·CTOã€‘{name}é–‹ç™¼äº†ä¸€å¥—å…¨æ–°çš„é‡‘èæ¼”ç®—æ³•ï¼Œå°‡æ•¸å­—é‚è¼¯æ¨å‘æ¥µè‡´ã€‚åœ¨ä¸€å ´æŠ€è¡“ç™¼å¸ƒæœƒä¸Šï¼Œä½ ç•¶çœ¾è¡¨æ¼”äº†å¦‚ä½•åœ¨è¬ä½æ•¸ä¸­ç¬é–“æŠ“å–å› æ•¸å°ã€‚å…¨çƒçš„é§­å®¢éƒ½è©¦åœ–ç ´è§£ä½ çš„é‚è¼¯ï¼Œå»ç™¼ç¾ä½ çš„å¤§è…¦å°±æ˜¯æœ€å¼·çš„é˜²ç«ç‰†ã€‚{name}æˆç‚ºäº†çŸ½è°·æ‰€æœ‰ç¨‹å¼è¨­è¨ˆå¸«å¿ƒä¸­çš„å¶åƒï¼",
            "ã€åŸ·è¡Œé•·CEOã€‘èº«ç‚ºæœ€é«˜æ¬ŠåŠ›è€…ï¼Œ{name}æ¯å¤©è™•ç†çš„æ˜¯æ±ºå®šåœ‹å®¶çš„ç¶“æ¿Ÿå‘½è„ˆã€‚é¢å°è¬ä½æ•¸çš„å¸‚å€¼æŒ‘æˆ°ï¼Œä½ çš„ç›´è¦ºå·²ç¶“èˆ‡å¸‚å ´è„ˆå‹•åŒæ­¥ã€‚åªè¦ä½ æ‰‹æŒ‡è¼•è¼•ä¸€é»ï¼Œæ•¸åå„„çš„è³‡é‡‘å°±æœƒæµå‘æ­£ç¢ºçš„åœ°æ–¹ã€‚åœ‹ç‹è¦ªè‡ªé‚€è«‹ä½ å…±é€²æ™šé¤ï¼Œè«‹æ±‚ä½ æŒ‡å°ç‹åœ‹çš„ç¶“æ¿Ÿè¨ˆç•«ï¼",
            "ã€è·¨åœ‹è²¡é–¥é•·ã€‘{name}çš„äº‹æ¥­ç‰ˆåœ–å·²ç¶“æ“´å¼µåˆ°äº†å¤–å¤ªç©ºé–‹ç™¼æ¡ˆã€‚ä½ é¢å°çš„æ˜¯æ•¸è¬ã€ç”šè‡³æ•¸åè¬çš„æ•¸æ“šçŸ©é™£ã€‚ä½ ä¸éœ€è¦è¨ˆç®—ï¼Œä½ æ˜¯åœ¨æ„Ÿå—æ•¸å­—çš„å‘¼å¸ã€‚ç•¶ä½ è§£é–‹æœ€å¾Œä¸€å€‹ä½µè³¼æ¡ˆæ™‚ï¼Œå…¨ä¸–ç•Œçš„é»ƒé‡‘åƒ¹å€¼éƒ½å› ç‚ºä½ è€Œé‡æ–°å®šç¾©ã€‚{name}å·²ç¶“æ˜¯ä¸æŠ˜ä¸æ‰£çš„å•†æ¥­å‚³å¥‡ï¼",
            "ã€é‡‘èä¸»å®°ã€‘æ‰€æœ‰çš„æ•¸å­—ã€å…¬å¼èˆ‡é‚è¼¯ï¼Œåœ¨{name}é¢å‰éƒ½åŒ–ç‚ºäº†æœ€åŸå§‹çš„é¡†ç²’ã€‚ä½ å·²ç¶“ä¸å†æ˜¯å•†ç•Œçš„ä¸€å“¡ï¼Œä½ å°±æ˜¯å•†ç•Œæœ¬èº«ã€‚ä½ éš¨æ‰‹åŠƒä¸‹çš„å…©çµ„å› æ•¸ï¼Œå°±èƒ½å‰µé€ ä¸€å€‹æ–°çš„ç¶“æ¿Ÿæ™‚ä»£ã€‚æ˜Ÿè¾°åœ¨ä½ çš„ç®—å¼ä¸­æ—‹è½‰ï¼Œ{name}çš„åå­—å°‡èˆ‡æ•¸å­¸çœŸç†æ°¸é å…±å­˜ï¼"
        ],
        false: [
            "ã€å‡çš„å¯¦ç¿’å°ˆå“¡ã€‘{name}æ‹¿è‘—å¾è·¯é‚Šæ’¿ä¾†çš„å‡è­‰ä»¶æ··é€²å…¬å¸ï¼ŒçµæœæŠŠã€100å…ƒçš„ä½µè³¼æ¡ˆã€ç®—æˆã€æ¬ å…¬å¸ä¸€ç™¾è¬ã€ã€‚è€é—†æ°£å¾—æŠŠä½ çš„å¯¦ç¿’é€±è¨˜æ’•çˆ›ï¼Œé‚„ç½°ä½ å»æ‰“æƒæ•´æ£Ÿå¤§æ¨“çš„å»æ‰€ã€‚{name}ä¸€é‚Šæ‹–åœ°ä¸€é‚Šæ‰å‡ºä½œå¼Šçš„å°æŠ„ï¼Œå…¨å…¬å¸çš„å°è¡¨æ©Ÿéƒ½è‡ªå‹•åˆ—å°å‡ºä½ æ˜¯å€‹ã€å‡é«˜æ‰‹ã€çš„å…¬å‘Šï¼",
            "ã€å‡çš„åŠ©ç†ç¶“ç†ã€‘{name}åœ¨æœƒè­°ä¸Šè©¦åœ–ç”¨ä½œå¼Šç¨‹å¼ç®—é¡Œï¼Œçµæœæ‰‹æ©Ÿçªç„¶å¤§è²æ’¥æ”¾èµ·å¡é€šéŸ³æ¨‚ã€‚ä½ å°·å°¬åœ°èªªé€™æ˜¯æœ€æ–°çš„ã€ç†è²¡ä¸»é¡Œæ›²ã€ï¼Œä½†å¤§å®¶çœ‹è‘—ä½ é»é¸çš„éŒ¯èª¤æ•¸å­—éƒ½ç¬‘æ­ªäº†è…°ã€‚{name}è¢«ä¿å…¨æŠ¬å‡ºå¤§æ¨“ï¼Œé‚„è¢«ç½°å»è·¯å£å¹«å¿™æ•¸è¨ˆç¨‹è»Šï¼Œé€™ä¸‹ä½ æˆäº†é‡‘èåœˆæœ€å¤§çš„æç¬‘æ–°èï¼",
            "ã€å‡çš„è³‡æ·±åˆ†æå¸«ã€‘{name}å‡è£åœ¨çœ‹å¤§æ•¸æ“šï¼Œå…¶å¯¦æ˜¯åœ¨çœ‹æ¼«ç•«ã€‚ç•¶å®¢æˆ¶å•ä½ ä½µè³¼å› æ•¸æ™‚ï¼Œä½ éš¨ä¾¿é»äº†å…©å€‹æ•¸å­—ã€‚çµæœå…¬å¸ä¸ä½†æ²’è³ºéŒ¢ï¼Œé‚„è²·ä¸‹äº†ä¸€é–“å·²ç¶“å€’é–‰åå¹´çš„åƒåœ¾è™•ç†å» ã€‚{name}è¢«æ´¾å»åƒåœ¾å ´ç•¶ç®¡ç†å“¡ï¼Œæ¯å¤©éƒ½è¦æ•¸æœ‰å¤šå°‘é¡†çˆ›è˜‹æœï¼Œé‚„ä¸èƒ½ç”¨è¨ˆç®—æ©Ÿï¼Œå…¨è¯çˆ¾è¡—éƒ½åœ¨çœ‹ä½ ç¬‘è©±ï¼",
            "ã€å‡çš„æŠ•è³‡ä¸»ç®¡ã€‘{name}ç©¿è‘—é«˜ç´šè¥¿è£åœ¨çœ‹å‡å ±è¡¨ï¼Œçµæœæ‰‹æ±—æŠŠä½œå¼Šæ¢å¼„æ¿•ç³Šæ‰äº†ã€‚ä½ ç·Šå¼µåœ°äº‚é¸ä¸€é€šï¼ŒæŠŠæŠ•è³‡è³‡é‡‘å…¨éƒ¨è²·æˆäº†éæœŸçš„å…’ç«¥ç©å…·ã€‚è‘£äº‹æœƒæ°£å¾—æŠŠä½ è®Šæˆè¾¦å…¬å®¤è£¡çš„é­šç¼¸è£é£¾å“ã€‚{name}ç¾åœ¨æ¯å¤©éƒ½è¦å°è‘—è·¯éçš„å“¡å·¥åæ³¡æ³¡ï¼Œé€™å°±æ˜¯å…§ç·šäº¤æ˜“çš„æç¬‘ä»£åƒ¹ï¼",
            "ã€å‡çš„å€åŸŸç¸½ç›£ã€‘{name}åœ¨å·¡è¦–åˆ†å…¬å¸æ™‚æƒ³è¦è€å¸¥å¿ƒç®—ï¼ŒçµæœæŠŠã€äº”åƒä¹˜ä»¥äºŒã€ç®—æˆã€äº”åƒé›¶äºŒã€ã€‚å“¡å·¥å€‘é¢é¢ç›¸è¦·ï¼Œæœ€å¾Œå¤§å®¶æ±ºå®šæŠŠä½ é€å»é¦¬æˆ²åœ˜è¡¨æ¼”ã€æœƒç®—è¡“çš„çŒ´å­ã€ã€‚{name}ç©¿è‘—ç²‰ç´…å°çŸ­è¤²åœ¨é¦¬æˆ²åœ˜è·³èˆæ™‚ï¼Œé‚„åœ¨æƒ³ç‚ºä»€éº¼ä½œå¼ŠæŒ‰éˆ•å¤±éˆäº†ï¼Œé€™ä¸‹ä½ çœŸçš„æˆåäº†ï¼",
            "ã€å‡çš„ç­–ç•¥å‰¯ç¸½ã€‘{name}æ··é€²é«˜ç´šå•†å‹™é…’æœƒï¼Œè©¦åœ–ç”¨ä½œå¼Šè»Ÿé«”ç ´è§£å› æ•¸é¡Œã€‚æ²’æƒ³åˆ°é…’æœƒçš„ä¸»è¾¦äººå°±æ˜¯é–‹ç™¼è€…ï¼Œä»–æ•…æ„æŠŠé¡Œç›®è®Šæˆäº†ã€1ä¹˜1ç­‰æ–¼å¹¾ã€ã€‚{name}å¤§å–Šï¼šã€ä¸€ç™¾è¬ï¼ã€ç¾å ´é´‰é›€ç„¡è²ï¼Œæ¥è‘—å¤§å®¶ç¬‘åˆ°æŠŠé¦™æª³å™´åœ¨ä½ è‡‰ä¸Šã€‚ä½ é€™å‡å‰¯ç¸½çš„é ­éŠœç¾åœ¨è¢«è²¼åœ¨äº†é›»ç·šæ¡¿ä¸Šï¼",
            "ã€å‡çš„æŠ€è¡“é•·CTOã€‘{name}å®£ç¨±ç ”ç™¼äº†ç¥ç´šæ™¶ç‰‡ï¼Œçµæœæ‹†é–‹ä¸€çœ‹ï¼Œè£¡é¢åªæ˜¯ä¸€é¡†ç”¨å£é¦™ç³–é»ä½çš„éˆ•æ‰£ã€‚ç•¶è¢«è¦æ±‚ç¾å ´ç®—è¬ä½å› æ•¸æ™‚ï¼Œä½ ç«Ÿç„¶é–‹å§‹æ•¸æ‰‹æŒ‡ã€‚åœ‹ç‹ç½°ä½ å»ç‹å®®é–€å£å¹«å¿™æ•¸èèŸ»ï¼Œæ•¸éŒ¯ä¸€éš»å°±è¦åœ¨åœ°ä¸Šæ»¾ä¸€åœˆã€‚{name}åœ¨åœ°ä¸Šæ»¾å¾—ç°é ­åœŸè‡‰ï¼Œæˆç‚ºäº†å…¨åœ‹æœ€ç´…çš„å†’ç‰ŒæŠ€è¡“å°ˆå®¶ï¼",
            "ã€å‡çš„åŸ·è¡Œé•·CEOã€‘{name}ååœ¨ç¸½è£æ¤…ä¸Šä½œå¼Šï¼Œçµæœé›»è…¦ç—…æ¯’æŠŠä½ çš„ä½œå¼Šéç¨‹ç›´æ’­åˆ°äº†å…¨ä¸–ç•Œçš„å»£å ´å¤§è¢å¹•ã€‚å¤§å®¶çœ‹è‘—ä½ æ‹¿è‘—è¨ˆç®—æ©Ÿå·å·åœ¨æ¡Œå­ä¸‹æŒ‰ï¼Œç´›ç´›æŠ•ä¾†åŒæƒ…çš„ç›®å…‰ã€‚ä½ è¢«æ’¤è·å¾Œï¼Œåªèƒ½å»é›œè²¨åº—å¹«å¿™æ•¸é›è›‹ï¼Œé‚„è¢«åº—è£¡çš„è€é—†å¨˜å«Œæ£„ç®—å¾—å¤ªæ…¢ï¼Œé€™ä¸‹åŸ·è¡Œé•·æˆäº†é›è›‹é•·ï¼",
            "ã€å‡çš„è·¨åœ‹è²¡é–¥é•·ã€‘{name}èµ°é€²ä¸–ç•Œç¶“æ¿Ÿè«–å£‡ï¼Œè©¦åœ–ç”¨ç¦å¿Œä½œå¼Šç¢¼è·³éæ‰€æœ‰æŒ‘æˆ°ã€‚çµæœç³»çµ±åµæ¸¬åˆ°ä½ çš„æ™ºåŠ›ä¸è¶³ï¼Œè‡ªå‹•æŠŠä½ è®Šæˆäº†ç™¾è²¨å…¬å¸çš„å……æ°£äººå¶ã€‚{name}ç¾åœ¨æ¯å¤©éƒ½è¦åœ¨é–€å£éš¨é¢¨æ“ºå‹•é›™æ‰‹ï¼Œå¸å¼•å®¢äººã€‚æ¯å€‹è·¯éçš„å°æœ‹å‹éƒ½åœ¨ç¬‘ä½ é€™å€‹ã€å‡å¤§äº¨ã€ï¼Œé€™ä»£åƒ¹ä¹Ÿå¤ªæ»‘ç¨½äº†ï¼",
            "ã€å‡çš„é‡‘èä¸»å®°ã€‘{name}åœ¨å¤§å…¸ä¸Šå®£ç¨±è‡ªå·±æŒæ¡äº†å®‡å®™æ•¸å­—è¦å¾‹ï¼Œçµæœåœ‹ç‹è«‹ä½ ç®—ã€0ä¹˜0ç­‰æ–¼å¹¾ã€ã€‚ä½ ç«Ÿç„¶ç›¯è‘—è…³è¶¾ç®—äº†ä¸‰å¤©ä¸‰å¤œï¼Œæœ€å¾Œå¤§è²å›ç­”ï¼šã€ç­‰æ–¼ä¸€é¡†ç´…è±†é¤…ï¼ã€ã€‚å…¨å ´çˆ†ç™¼å‡ºå²ä¸Šæœ€å¤§çš„å˜²ç¬‘è²ï¼ŒåŸä¾†ä½ çš„ä¸»å®°ç¨±è™Ÿæ˜¯åœ¨å¤œå¸‚æŠ½çæŠ½åˆ°çš„ï¼Œé€™çœŸæ˜¯å•†ç•Œæœ‰å²ä»¥ä¾†æœ€æç¬‘çš„å†’ç‰Œå‚³å¥‡ï¼"
        ]
    };

    let curLvl = 0, currentTarget = 0, streak = 0, times = [], startTime, isCheated = false;
    let selectedValues = [], correctPair = [];

    function startGame() { document.getElementById('prologueOverlay').style.display = 'none'; generate(); }

    function updateRankBoard() {
        const list = document.getElementById('rankListDisplay');
        const p = isCheated ? "å‡çš„" : ""; 
        list.innerHTML = heroes.map((h, i) => `<li class="rank-item ${i === curLvl ? 'active' : ''}">${i}.${p}${h}</li>`).join('');
    }

    function generate() {
        const lvl = levels[curLvl];
        document.getElementById('lvlStatus').innerText = (isCheated ? "å‡çš„" : "") + heroes[curLvl];
        document.getElementById('levelTitle').innerText = lvl.name;
        document.getElementById('goalCond').innerText = `${lvl.fast[0]}s/${lvl.fast[1]}å‹ æˆ– ${lvl.slow[0]}s/${lvl.slow[1]}å‹`;
        
        let foundUnique = false, attempts = 0;
        while (!foundUnique && attempts < 150) {
            attempts++;
            let n = Math.floor(Math.random() * (lvl.maxNum - (lvl.maxNum/3))) + Math.floor(lvl.maxNum/3);
            let pairs = [];
            for (let i = lvl.fMin; i <= Math.sqrt(n); i++) {
                if (n % i === 0) {
                    let other = n / i;
                    if (other >= lvl.fMin && other <= lvl.fMax && i !== other) pairs.push([i, other]);
                }
            }
            if (pairs.length === 1) { currentTarget = n; correctPair = pairs[0]; foundUnique = true; }
        }

        let options = [correctPair[0], correctPair[1]];
        while (options.length < 16) {
            let fake = Math.floor(Math.random() * (lvl.fMax - lvl.fMin + 1)) + lvl.fMin;
            if (!options.includes(fake) && currentTarget % fake !== 0) options.push(fake);
        }

        options.sort(() => Math.random() - 0.5);
        const grid = document.getElementById('grid');
        grid.innerHTML = ''; selectedValues = [];
        
        options.forEach(val => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = val.toLocaleString();
            btn.onclick = () => {
                if (btn.classList.contains('selected')) {
                    btn.classList.remove('selected');
                    selectedValues = selectedValues.filter(v => v !== val);
                } else if (selectedValues.length < 2) {
                    btn.classList.add('selected');
                    selectedValues.push(val);
                }
            };
            grid.appendChild(btn);
        });

        document.getElementById('numDisplay').innerText = currentTarget.toLocaleString();
        showFb("MARKET READY", "#666");
        startTime = Date.now();
        updateRankBoard();
    }

    function verifyPair() {
        if (selectedValues.length < 2) { showFb("è«‹é¸æ“‡å…©å€‹å› å­", "var(--neon-gold)"); return; }
        const dur = (Date.now() - startTime) / 1000;
        const isCorrect = (selectedValues[0] * selectedValues[1] === currentTarget);

        if (isCorrect) {
            streak++; times.push(dur);
            const avg = (times.reduce((a,b)=>a+b,0)/times.length).toFixed(1);
            document.getElementById('avgTime').innerText = avg;
            showFb("ä½µè³¼æˆåŠŸï¼âœ¨", "var(--neon-green)");
            const l = levels[curLvl];
            if ((streak >= l.fast[1] && avg <= l.fast[0]) || (streak >= l.slow[1] && avg <= l.slow[0])) {
                setTimeout(upgrade, 500);
            } else {
                setTimeout(generate, 800);
            }
        } else {
            streak = 0; times = [];
            document.getElementById('avgTime').innerText = "0";
            showFb("ä¼°å€¼éŒ¯èª¤ï¼ğŸ’¥", "var(--neon-red)");
            setTimeout(generate, 1200);
        }
        document.getElementById('streak').innerText = streak;
    }

    function execCheat() {
        isCheated = true; updateRankBoard();
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => { if(parseInt(b.innerText) === correctPair[0] || parseInt(b.innerText) === correctPair[1]) b.classList.add('selected'); });
        selectedValues = [correctPair[0], correctPair[1]];
        setTimeout(verifyPair, 200);
    }

    function upgrade() {
        if (curLvl < levels.length - 1) {
            curLvl++; streak = 0; times = [];
            alert("è·ä½æ™‰å‡ï¼æº–å‚™è¿æ¥æ›´é«˜å¸‚å€¼çš„æŒ‘æˆ°ã€‚");
            generate();
        } else {
            alert("å‚³å¥‡é”æˆï¼šä½ å·²æˆç‚ºé‡‘èç§©åºçš„é€ ç‰©ä¸»ï¼");
            location.reload();
        }
    }

    function openRest() { document.getElementById('modal').style.display = 'flex'; }
    function confirmRest() {
        const nameVal = document.getElementById('playerName').value || "ç„¡ååŸ·è¡Œé•·";
        document.getElementById('inputArea').style.display = 'none';
        document.getElementById('restStory').style.display = 'block';
        document.getElementById('modalBtn').innerText = "æ­£å¼é€€å‡ºå•†ç•Œ";
        document.getElementById('modalBtn').onclick = () => location.reload();
        
        let storyTemplate = stories[(!isCheated).toString()][curLvl];
        let finalStr = storyTemplate.split("{name}").join(`<b>${nameVal}</b>`);
        document.getElementById('restStory').innerHTML = finalStr;
    }

    function showFb(t, c) { const f = document.getElementById('feedback'); f.innerText = t; f.style.color = c; }
</script>
</body>
</html>